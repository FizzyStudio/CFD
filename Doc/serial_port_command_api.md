
# serial port command api

> __author__ = 'ascetic'

* 通过串口发送指定的命令给FPGA以实现LED的时序控制
* LED的时序由 测量光|光化光|饱和光 三种基本模式组成，通过组合这三种模式，可以实现多种复杂的时序控制模式
* FPGA只在触发测量脉冲时，同时触发CCD脉冲，以拍摄图像，而在其他脉冲（光化光脉冲或饱和光脉冲）时，都不会触发CCD脉冲
* 测量脉冲与CCD脉冲保持同步，可通过命令设置时间差，但不建议修改

## 光参数设置

### 测量光

#### 设置测量光参数

    参数设置：55 AA 01 脉宽（10-10000us, 2 bytes）周期（100-1000ms, 2 bytes）                 
    应答：AA 55 01 脉宽（10-10000us, 2 bytes）周期（100-1000ms, 2 bytes）

##### example

* 55 AA 01 07 D0 01 F4  设置脉宽2000us，周期500ms（2Hz）
* 55 AA 01 00 64 00 64  设置脉宽100us，周期100ms（10Hz）

#### 读取测量光参数

    参数读取：55 AA 02 
    应答：AA 55 02 脉宽（10-10000us, 2 bytes）周期（100-1000ms, 2 bytes）

### 光化光

##### 设置光化光参数

    参数设置：55 AA 03 光化光脉宽（10-1000us, 2 bytes） 光化光循环次数（10-2000, 2 bytes） 光化光下降沿到测量脉冲上升沿（100-1000us, 2bytes） 测量脉冲下降沿到新的光化光上升沿（1000-10000us, 2bytes）
    应答：AA 55 03 光化光脉宽（10-1000us, 2bytes） 光化光循环次数（10-2000, 2 bytes） 光化光下降沿到测量脉冲上升沿（100-1000us, 2bytes） 测量脉冲下降沿到新的光化光上升沿（1000-10000us, 2bytes）

* 光化光循环次数：                  指的是N个光化光循环后，触发一次测量脉冲
* 光化光下降沿到测量脉冲上升沿：     指的是光化光下降沿到测量脉冲上升沿的时间间隔,us为单位
* 测量脉冲下降沿到新的光化光上升沿：  指的是测量脉冲下降沿到新的光化光上升沿的时间间隔,us为单位
* 光化光周期为固定值： 1000us
* 测量脉冲的脉宽与测量光参数中的脉宽一致

##### example

* 55 AA 03 01 F4 00 32 01 F4 13 88  设置光化光脉宽500us,每50个光化光循环后出现一次测量脉冲,光化光下降沿到测量脉冲上升沿时间间隔500us，测量脉冲下降沿到新的光化光上升沿时间间隔5000us

#### 读取光化光参数

    参数读取：55 AA 04 
    应答：AA 55 04 光化光脉宽（10-1000us, 2bytes） 光化光循环次数（10-2000, 2 bytes） 光化光下降沿到测量脉冲上升沿（100-1000us, 2bytes） 测量脉冲下降沿到新的光化光上升沿（1000-10000us, 2bytes）

### 饱和光

##### 设置饱和光参数
    
    参数设置：55 AA 05 饱和光脉宽（100-1000us, 2 bytes） 饱和光循环次数（10-2000, 2 bytes） 饱和光下降沿到测量脉冲上升沿（100-1000us, 2 bytes） 测量脉冲下降沿到新的饱和光上升沿（1000-10000us）
    应答：AA 55 05 饱和光脉宽（100-1000us, 2 bytes） 饱和光循环次数（10-2000, 2 bytes） 饱和光下降沿到测量脉冲上升沿（100-1000us, 2 bytes） 测量脉冲下降沿到新的饱和光上升沿（1000-10000us）

* 饱和光循环次数：                   指的是N个饱和光循环后，触发一次测量脉冲
* 饱和光下降沿到测量脉冲上升沿：      指的是饱和光下降沿到测量脉冲上升沿的时间间隔,us为单位
* 测量脉冲下降沿到新的饱和光上升沿：   指的是测量脉冲下降沿到新的饱和上升沿的时间间隔,us为单位
* 饱和光周期为固定值： 1000us
* 测量脉冲的脉宽与测量光参数中的脉宽一致

##### example

* 55 AA 05 02 BC 00 5A 01 F4 13 88  设置饱和光脉宽700us 每90个饱和光循环后出现一次测量脉冲 饱和光下降沿到测量脉冲上升沿时间间隔500us 测量脉冲下降沿到新的饱和光上升沿时间间隔5000us

#### 读取饱和光参数

    参数读取：55 AA 06                                                      
    应答：AA 55 06 饱和光脉宽（100-1000us, 2 bytes） 饱和光循环次数（10-2000, 2 bytes） 饱和光下降沿到测量脉冲上升沿（100-1000us, 2 bytes） 测量脉冲下降沿到新的饱和光上升沿（1000-10000us）

## CCD触发脉冲与测量脉冲时差

### 设置

    参数设置：55 AA 07 延时符号（0超前，1滞后） 延时量（0-100us, 1 byte）
    应答：AA 55 07
    
*　延时符号：　0 CCD触发脉冲晚于测量脉冲    1 CCD触发脉冲早于测量脉冲

### 读取

    参数读取：55 AA 08                                                         
    应答：AA 55 08 延时符号（0超前，1滞后） 延时量（0-100us, 1 byte）
    
>　不建议调节该参数．
   
## 工作模式启动/停止

### 启动指定模式

    参数设置：55 AA 09 模式（01: 测量光 02:光化光 03:饱和光）  
    应答：AA 55 09 模式（01: 测量光 02:光化光 03:饱和光）

### 停止
    
    参数设置：55 AA 0D

* 停止当前正在运行的LED模式

## 复位（重置）

    参数设置：55 AA 0A 
    应答：AA 55 0A

